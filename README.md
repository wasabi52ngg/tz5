# Приложение импорта/экспорта контактов Битрикс24

## Описание

Локальное приложение для импорта и экспорта контактов в/из Битрикс24 с поддержкой CSV и XLSX форматов.

## Функциональность

### Импорт контактов
- Загрузка файлов CSV и XLSX
- Автоматическое создание контактов в Битрикс24
- Привязка компаний по названию
- Пакетная обработка для эффективности
- Детальные сообщения об ошибках

### Экспорт контактов
- Выгрузка контактов в CSV или XLSX
- Фильтрация по дате создания
- Экспорт всех полей контакта

### Управление контактами
- Удаление всех контактов (для тестирования)
- Пакетное удаление через API

## Формат файла импорта

Файл должен содержать следующие колонки:
- `имя` - имя контакта
- `фамилия` - фамилия контакта  
- `отчество` - отчество контакта (необязательно)
- `номер телефона` - номер телефона
- `почта` - email адрес
- `компания` - название компании (будет привязана по названию)

## Архитектура

### Модульная структура
- **Сервисы** (`services.py`) - работа с API Битрикс24
- **Обработчики файлов** (`file_handlers.py`) - модульная обработка CSV/XLSX
- **Формы** (`forms.py`) - валидация данных
- **Представления** (`views.py`) - обработка запросов

### Алгоритм импорта
1. Создание контактов без привязки к компаниям
2. Получение списка компаний пакетно
3. Привязка компаний к контактам

## Установка

1. Установите зависимости:
```bash
pip install -r requirements.txt
```

2. Выполните миграции:
```bash
python manage.py migrate
```

3. Запустите сервер:
```bash
python manage.py runserver
```

## Использование

1. Откройте приложение в браузере
2. Для импорта:
   - Перейдите на страницу "Импорт"
   - Загрузите файл CSV или XLSX
   - Нажмите "Импортировать контакты"
3. Для экспорта:
   - Перейдите на страницу "Экспорт"
   - Выберите формат и период
   - Нажмите "Экспортировать контакты"
4. Для тестирования:
   - Используйте кнопку "Удалить все контакты" на главной странице

## Тестовые данные

В файле `test_contacts.csv` содержатся тестовые контакты для проверки функциональности.

## Особенности

- Эффективная пакетная обработка через `batch_api_call`
- Модульная архитектура для легкого добавления новых форматов
- Детальные сообщения об ошибках
- Поддержка больших файлов
- Автоматическая привязка компаний

## API Битрикс24

Приложение использует следующие методы API:
- `crm.contact.add` - создание контакта
- `crm.contact.list` - получение списка контактов
- `crm.contact.delete` - удаление контакта
- `crm.contact.company.add` - привязка компании к контакту
- `crm.company.list` - получение списка компаний
- `batch` - пакетные операции
